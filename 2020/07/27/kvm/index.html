<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>kvm | Morning</title><meta name="description" content="企业私有云容器化架构运维实战 了解什么是虚拟化:1虚拟化（Virtualization）技术最早出现在 20 世纪 60 年代的 IBM 大型机系统，在70年代的 System 370 系列中逐渐流行起来，这些机器通过一种叫虚拟机监控器（Virtual Machine Monitor，VMM）的程序在物理硬件之上生成许多可以运行独立操作系统软件的虚拟机（Virtual Machine）实例。随着近"><meta name="author" content="CG"><meta name="copyright" content="CG"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/heart.png"><link rel="canonical" href="http://yoursite.com/2020/07/27/kvm/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="kvm"><meta property="og:url" content="http://yoursite.com/2020/07/27/kvm/"><meta property="og:site_name" content="Morning"><meta property="og:description" content="企业私有云容器化架构运维实战 了解什么是虚拟化:1虚拟化（Virtualization）技术最早出现在 20 世纪 60 年代的 IBM 大型机系统，在70年代的 System 370 系列中逐渐流行起来，这些机器通过一种叫虚拟机监控器（Virtual Machine Monitor，VMM）的程序在物理硬件之上生成许多可以运行独立操作系统软件的虚拟机（Virtual Machine）实例。随着近"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-07-27T05:07:33.000Z"><meta property="article:modified_time" content="2020-07-27T05:17:23.685Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="docker" href="http://yoursite.com/2020/07/27/docker/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标题</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#企业私有云容器化架构运维实战"><span class="toc-number">1.</span> <span class="toc-text">企业私有云容器化架构运维实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#了解"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">了解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#什么是虚拟化"><span class="toc-number">1.0.0.1.1.</span> <span class="toc-text">什么是虚拟化:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#平台虚拟化类型"><span class="toc-number">1.0.0.1.2.</span> <span class="toc-text">平台虚拟化类型</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVM虚拟化技术简介"><span class="toc-number">1.1.</span> <span class="toc-text">KVM虚拟化技术简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVM安装"><span class="toc-number">1.2.</span> <span class="toc-text">KVM安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#备注"><span class="toc-number">1.3.</span> <span class="toc-text">备注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVM虚拟机管理"><span class="toc-number">1.4.</span> <span class="toc-text">KVM虚拟机管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#虚拟机添加设备"><span class="toc-number">1.5.</span> <span class="toc-text">虚拟机添加设备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVM网络配置"><span class="toc-number">1.6.</span> <span class="toc-text">KVM网络配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVM存储配置"><span class="toc-number">1.7.</span> <span class="toc-text">KVM存储配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kvm快照"><span class="toc-number">1.8.</span> <span class="toc-text">kvm快照</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kvm迁移（了解）"><span class="toc-number">1.9.</span> <span class="toc-text">kvm迁移（了解）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动化脚本管理kvm（留时间给大家写）"><span class="toc-number">1.10.</span> <span class="toc-text">自动化脚本管理kvm（留时间给大家写）</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Morning</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标题</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">kvm</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-27 13:07:33"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-07-27</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-27 13:17:23"><i class="fas fa-history fa-fw"></i> 更新于 2020-07-27</span></time></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">8k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 35 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="企业私有云容器化架构运维实战"><a href="#企业私有云容器化架构运维实战" class="headerlink" title="企业私有云容器化架构运维实战"></a><strong>企业私有云容器化架构运维实战</strong></h1><p><img src= "/img/loading.gif" data-src="https://i.loli.net/2019/06/04/5cf61b854224d74429.png" alt></p>
<h4 id="了解"><a href="#了解" class="headerlink" title="了解"></a><strong>了解</strong></h4><h5 id="什么是虚拟化"><a href="#什么是虚拟化" class="headerlink" title="什么是虚拟化:"></a><strong>什么是虚拟化:</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">虚拟化（Virtualization）技术最早出现在 20 世纪 60 年代的 IBM 大型机系统，在70年代的 System 370 系列中逐渐流行起来，这些机器通过一种叫虚拟机监控器（Virtual Machine Monitor，VMM）的程序在物理硬件之上生成许多可以运行独立操作系统软件的虚拟机（Virtual Machine）实例。随着近年多核系统、集群、网格甚至云计算的广泛部署，虚拟化技术在商业应用上的优势日益体现，不仅降低了 IT 成本，而且还增强了系统安全性和可靠性。</span><br></pre></td></tr></table></figure>

<p><strong>常用的虚拟化产品有哪些</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.Kvm（redhat）企业级</span><br><span class="line">2.Vmware:</span><br><span class="line">Vmware-workstation(windows和linux)桌面级</span><br><span class="line">Vmware-fusion(mac)</span><br><span class="line">Vmware-esxi(企业级别)本身就是一个操作系统。</span><br><span class="line">3.hyper-v(微软）</span><br><span class="line">4.Ovm（oracle公司--Windows linux） virtulbox</span><br><span class="line">5.Xen（rhel6之前所有版本默认用的虚拟化产品）</span><br></pre></td></tr></table></figure>

<p><strong>虚拟化技术的分类:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">平台虚拟化（Platform Virtualization），针对计算机和操作系统的虚拟化//针对计算机操作系统。</span><br><span class="line">资源虚拟化（Resource Virtualization），针对特定的系统资源的虚拟化，比如内存、存储、网络资源等。</span><br><span class="line">应用程序虚拟化（Application Virtualization），包括仿真、模拟、解释技术等。把硬件的东西变成了一个应用</span><br></pre></td></tr></table></figure>

<p>​      我们通常所说的虚拟化主要是指平台虚拟化技术，通过使用控制程序（Control Program，也被称为 Virtual Machine Monitor(虚拟监控器VMM) 或<strong>Hypervisor</strong>，隐藏特定计算平台的实际物理特性，为用户提供抽象的、统一的、模拟的计算环境（称为虚拟机）。</p>
<h5 id="平台虚拟化类型"><a href="#平台虚拟化类型" class="headerlink" title="平台虚拟化类型"></a><strong>平台虚拟化类型</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">操作系统虚拟化:有一个非常常见的操作系统叫openvz。特点是所有的虚拟机共享宿主机的内核。</span><br></pre></td></tr></table></figure>

<p><strong>全虚拟化（Full Virtualization):</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">全虚拟化是指虚拟机模拟了完整的底层硬件，包括处理器、物理内存、时钟、外设等，使得为原始硬件设计的操作系统或其它系统软件完全不做任何修改就可以在虚拟机中运行。</span><br><span class="line"></span><br><span class="line">现在的kvm与vmware都支持全虚拟化</span><br><span class="line"></span><br><span class="line">全虚拟化的运行速度要快于硬件模拟，但是性能方面不如裸机，因为Hypervisor需要占用一些资源</span><br></pre></td></tr></table></figure>

<p><strong>半虚拟化（Para Virtualization）:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">半虚拟化（也叫超虚拟化）是另一种类似于全虚拟化的技术，它使用Hypervisor分享存取底层的硬件，但是它的guest操作系统集成了虚拟化方面的代码。因为操作系统自身能够与虚拟进程进行很好的协作。</span><br><span class="line"></span><br><span class="line">半虚拟化需要guest操作系统做一些修改，使guest操作系统意识到自己是处于虚拟化环境的，但是半虚拟化提供了与原操作系统相近的性能。</span><br></pre></td></tr></table></figure>

<p><strong>硬件辅助虚拟化</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">硬件辅助虚拟化是指借助硬件（主要是主机处理器）的支持来实现高效的全虚拟化。</span><br></pre></td></tr></table></figure>

<p><strong>部分虚拟化</strong></p>
<p><strong>企业级虚拟化与桌面级虚拟化的区别</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">桌面级虚拟化：</span><br><span class="line">App  ---在安装APP，通过App实现各种功能</span><br><span class="line">guestos  ---客户机也叫客户操作系统</span><br><span class="line">vmware-workstation（hypervisor（虚拟机管理程序）+图形管理工具）</span><br><span class="line">os</span><br><span class="line">硬件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">企业级虚拟化</span><br><span class="line">App（图形管理工具）</span><br><span class="line">guestos</span><br><span class="line">os+hypervisor：在操作系统级别加上了虚拟机管理程序</span><br><span class="line">硬件</span><br></pre></td></tr></table></figure>

<h2 id="KVM虚拟化技术简介"><a href="#KVM虚拟化技术简介" class="headerlink" title="KVM虚拟化技术简介"></a>KVM虚拟化技术简介</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KVM 针对运行在 x86 硬件上的、驻留在内核中的虚拟化基础结构。KVM 是第一个成为原生 Linux 内核（2.6.20）的一部分的 hypervisor，它是由 Avi Kivity 开发和维护的，现在归 Red Hat 所有。</span><br><span class="line">KVM 是作为内核模块实现的</span><br></pre></td></tr></table></figure>

<h2 id="KVM安装"><a href="#KVM安装" class="headerlink" title="KVM安装"></a>KVM安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvm虚拟化平台软件一般装在操作系统为Centos上面</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">大家不想把电脑装为Centos的操作系统，可以用VMware workstations装一台配置较高的虚拟机（cpu、内存、磁盘）给的尽可能最大，然后需要在开启之前做如下操作</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571883832374.png" alt="1571883832374"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571883850670.png" alt="1571883850670"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571883863183.png" alt="1571883863183"></p>
<p><strong>然后打开虚拟机，安装kvm即可</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看cpu是否支持虚拟化</span><br><span class="line"><span class="meta">#</span><span class="bash"> cat /proc/cpuinfo | grep -E <span class="string">'vmx|svm'</span></span></span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584185166552.png" alt="1584185166552"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">"关闭防火墙和selinux"</span><br><span class="line"></span><br><span class="line">一般企业如果使用kvm虚拟机平台，都会把物理服务器装成Centos的操作系统，然后装上kvm，创建使用虚拟机</span><br><span class="line"></span><br><span class="line">1.需求内核(rhel6以上):</span><br><span class="line">[root@kvm-server ~]# uname -r </span><br><span class="line">3.10.0-1062.el7.x86_64</span><br><span class="line">2.如果之前安装kvm了清理环境：卸载kvm</span><br><span class="line">[root@kvm-server ~]# yum remove `rpm -qa | egrep 'qemu|virt|kvm'` -y</span><br><span class="line">[root@kvm-server ~]# rm -rf /var/lib/libvirt  /etc/libvirt/</span><br><span class="line">3.升级系统：(在安装虚拟机出错的情况下，一般是操作系统的版本问题)</span><br><span class="line">[root@kvm-server ~]# yum upgrade</span><br><span class="line">4.安装软件：</span><br><span class="line">[root@kvm-server ~]# yum install *qemu*  *virt*  librbd1-devel -y</span><br><span class="line">其实下载的是下面几款软件</span><br><span class="line">[root@kvm-server ~]# yum install qemu-kvm libvirt virt-manager  librbd1-devel -y   </span><br><span class="line">qemu-kvm libvirt virt-manager </span><br><span class="line"></span><br><span class="line">qemu-kvm ： 主包</span><br><span class="line">libvirt：api接口</span><br><span class="line">virt-manager：图形化界面</span><br><span class="line"></span><br><span class="line">在所谓的kvm技术中，应用到的其实有2个东西：qemu+kvm</span><br><span class="line">kvm负责cpu虚拟化+内存虚拟化，实现了cpu和内存的虚拟化，但kvm不能模拟其他设备；</span><br><span class="line">qemu是模拟IO设备（网卡，磁盘），kvm加上qemu之后就能实现真正意义上服务器虚拟化。</span><br><span class="line">因为用到了上面两个东西，所以一般都称之为qemu-kvm。</span><br><span class="line">libvirt则是调用kvm虚拟化技术的接口用于管理的，用libvirt管理方便，直接用qemu-kvm的接口太繁琐。</span><br><span class="line"></span><br><span class="line">5.启动服务:    </span><br><span class="line">centos7:</span><br><span class="line">[root@kvm-server ~]# systemctl start libvirtd</span><br><span class="line">6.查看kvm模块加载:</span><br><span class="line">[root@kvm-server ~]# lsmod | grep kvm</span><br><span class="line">kvm_intel             188644  0 </span><br><span class="line">kvm                   621480  1 kvm_intel</span><br><span class="line">irqbypass              13503  1 kvm</span><br><span class="line">如果看到有这两行，说明支持kvm模块</span><br></pre></td></tr></table></figure>

<p><strong>KVM gustos图形方式部署安装虚拟机—需要掌握</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-server ~]# virt-manager</span><br><span class="line">====================</span><br><span class="line">下面就是点点点</span><br><span class="line"></span><br><span class="line">安装完成一台虚拟机之后，网络模式默认是NAT的。</span><br></pre></td></tr></table></figure>

<p><strong>完全文本方式安装虚拟机</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-server ~]# yum install -y vsftpd  #安装ftp，并配置最后将镜像上传到ftp中</span><br><span class="line">[root@kvm-server ~]# mkdir /var/ftp/centos7u4</span><br><span class="line">[root@kvm-server IOS]# mount CentOS-7-x86_64-DVD-1708.iso /var/ftp/centos7u4/</span><br><span class="line"></span><br><span class="line">记住打开</span><br><span class="line">systemctl start vsfptd</span><br><span class="line">ip为br0的ip</span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# virt-install --connect qemu:///system -n vm10 -r 2050 --disk path=/var/lib/libvirt/images/vm10.img,size=5  --os-type=linux --os-variant=centos7.0 --vcpus=1  --location=ftp://10.0.111.182/centos7u4 -x console=ttyS0 --nographics</span><br><span class="line"></span><br><span class="line">用这种方式安装的操作系统有一个毛病：纯文本安装的输入时大小写莫名的变换，远程ssh没问题。内存不低于2G</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">virt-install </span><br><span class="line">bash: virt-install: 未找到命令...</span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install libguestfs-tools -y</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install virt-install.noarch -y</span></span><br><span class="line"></span><br><span class="line">参数解释：</span><br><span class="line">-n name</span><br><span class="line">-r  以M为单位指定分配给虚拟机的内存大小</span><br><span class="line">--disk 指定作为客户机存储的媒介 size以G为单位的存储</span><br><span class="line">--os-type   系统类型</span><br><span class="line">--os-variant 系统类型版本</span><br><span class="line">--vcpus 指定核数，不能超过物理cpu</span><br><span class="line">--location  客户虚拟机安装源下载，必须为镜像挂载在ftp目录下</span><br><span class="line">-x console=ttyS0 执行终端0</span><br><span class="line">--nographics 无图形，文本模式</span><br></pre></td></tr></table></figure>

<p>注意：命令敲下去，不要误操作退出安装<img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571888912686.png" alt="1571888912686"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571888994236.png" alt="1571888994236"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571899799370.png" alt="1571899799370"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571899841651.png" alt="1571899841651"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571900561999.png" alt="1571900561999"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584115405588.png" alt="1584115405588"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584277302582.png" alt="1584277302582"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584277352951.png" alt="1584277352951"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584277388759.png" alt="1584277388759"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584277434201.png" alt="1584277434201"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584116022881.png" alt="1584116022881"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584116087341.png" alt="1584116087341"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584116391245.png" alt="1584116391245"></p>
<p>需要等一会了大约20分钟左右</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1584116673077.png" alt="1584116673077"></p>
<p>按空格退出！</p>
<p>下面的操作根据提示点点就可以了</p>
<p><strong>模板镜像+配置文件 方式安装虚拟机—需要掌握</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">1.虚拟机配置文件</span><br><span class="line">[root@kvm-server ~]# ls /etc/libvirt/qemu</span><br><span class="line">networks  vm2.xml</span><br><span class="line">2.储存虚拟机的介质</span><br><span class="line">[root@kvm-server ~]# ls /var/lib/libvirt/images/</span><br><span class="line">vm2.img</span><br><span class="line">==============================</span><br><span class="line">define方式创建好，不会启动</span><br><span class="line">create方式创建好，会启动</span><br><span class="line">实战：</span><br><span class="line">1.拷贝模板镜像和配置文件</span><br><span class="line">[root@kvm-server ~]# cp /etc/libvirt/qemu/vm2.xml /etc/libvirt/qemu/vm3.xml</span><br><span class="line">[root@kvm-server ~]# cp /var/lib/libvirt/images/vm2.img /var/lib/libvirt/images/vm3.img </span><br><span class="line">2.修改配置文件</span><br><span class="line">生成新的UUID</span><br><span class="line">[root@kvm-server ~]# uuidgen</span><br><span class="line">2e3fa6db-ff7f-41c3-bc8f-0428e81ebb57</span><br><span class="line">[root@kvm-server ~]# vim /etc/libvirt/qemu/vm3.xml</span><br><span class="line">domain type='kvm'&gt;</span><br><span class="line">  &lt;name&gt;vm3&lt;/name&gt;  #名字不能一样需要修改</span><br><span class="line">  &lt;uuid&gt;2e3fa6db-ff7f-41c3-bc8f-0428e81ebb57&lt;/uuid&gt; #uuid不能一样需要修改</span><br><span class="line">  &lt;memory unit='KiB'&gt;1024000&lt;/memory&gt;  #内存，可选</span><br><span class="line">  &lt;currentMemory unit='KiB'&gt;1024000&lt;/currentMemory&gt;  #当前内存与上面定义一样</span><br><span class="line">  &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;  #cpu可选</span><br><span class="line">  &lt;os&gt;</span><br><span class="line">    &lt;type arch='x86_64' machine='pc-i440fx-rhel7.0.0'&gt;hvm&lt;/type&gt;</span><br><span class="line">    &lt;boot dev='hd'/&gt;</span><br><span class="line">  &lt;/os&gt;</span><br><span class="line">  &lt;features&gt;</span><br><span class="line">    &lt;acpi/&gt;</span><br><span class="line">    &lt;apic/&gt;</span><br><span class="line">  &lt;/features&gt;</span><br><span class="line">  &lt;cpu mode='custom' match='exact' check='partial'&gt;</span><br><span class="line">    &lt;model fallback='allow'&gt;SandyBridge-IBRS&lt;/model&gt;</span><br><span class="line">    &lt;feature policy='require' name='md-clear'/&gt;</span><br><span class="line">    &lt;feature policy='require' name='spec-ctrl'/&gt;</span><br><span class="line">    &lt;feature policy='require' name='ssbd'/&gt;</span><br><span class="line">  &lt;/cpu&gt;</span><br><span class="line">  &lt;clock offset='utc'&gt;</span><br><span class="line">    &lt;timer name='rtc' tickpolicy='catchup'/&gt;</span><br><span class="line">    &lt;timer name='pit' tickpolicy='delay'/&gt;</span><br><span class="line">    &lt;timer name='hpet' present='no'/&gt;</span><br><span class="line">  &lt;/clock&gt;</span><br><span class="line">  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;</span><br><span class="line">  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;</span><br><span class="line">  &lt;on_crash&gt;destroy&lt;/on_crash&gt;</span><br><span class="line">  &lt;pm&gt;</span><br><span class="line">    &lt;suspend-to-mem enabled='no'/&gt;</span><br><span class="line">    &lt;suspend-to-disk enabled='no'/&gt;</span><br><span class="line">  &lt;/pm&gt;</span><br><span class="line">  &lt;devices&gt;</span><br><span class="line">    &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;</span><br><span class="line">    &lt;disk type='file' device='disk'&gt;</span><br><span class="line">      &lt;driver name='qemu' type='qcow2'/&gt;</span><br><span class="line">      &lt;source file='/var/lib/libvirt/images/vm3.img'/&gt;   #磁盘镜像需要修改</span><br><span class="line">      &lt;target dev='vda' bus='virtio'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;</span><br><span class="line">    &lt;/disk&gt;</span><br><span class="line">    &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x7'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;</span><br><span class="line">      &lt;master startport='0'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0' multifunction='on'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;</span><br><span class="line">      &lt;master startport='2'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x1'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;</span><br><span class="line">      &lt;master startport='4'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x2'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type='pci' index='0' model='pci-root'/&gt;</span><br><span class="line">    &lt;controller type='virtio-serial' index='0'&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x0'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;interface type='network'&gt;</span><br><span class="line">      &lt;mac address='52:54:00:82:d6:3c'/&gt;  #mac地址不能一样需要修改，只能修改后三段。</span><br><span class="line">      &lt;source network='default'/&gt;</span><br><span class="line">      &lt;model type='virtio'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;</span><br><span class="line">    &lt;/interface&gt;</span><br><span class="line">    &lt;serial type='pty'&gt;</span><br><span class="line">      &lt;target type='isa-serial' port='0'&gt;</span><br><span class="line">        &lt;model name='isa-serial'/&gt;</span><br><span class="line">      &lt;/target&gt;</span><br><span class="line">    &lt;/serial&gt;</span><br><span class="line">    &lt;console type='pty'&gt;</span><br><span class="line">      &lt;target type='serial' port='0'/&gt;</span><br><span class="line">    &lt;/console&gt;</span><br><span class="line">    &lt;channel type='unix'&gt;</span><br><span class="line">      &lt;target type='virtio' name='org.qemu.guest_agent.0'/&gt;</span><br><span class="line">      &lt;address type='virtio-serial' controller='0' bus='0' port='1'/&gt;</span><br><span class="line">    &lt;/channel&gt;</span><br><span class="line">    &lt;channel type='spicevmc'&gt;</span><br><span class="line">      &lt;target type='virtio' name='com.redhat.spice.0'/&gt;</span><br><span class="line">      &lt;address type='virtio-serial' controller='0' bus='0' port='2'/&gt;</span><br><span class="line">    &lt;/channel&gt;</span><br><span class="line">    &lt;input type='tablet' bus='usb'&gt;</span><br><span class="line">      &lt;address type='usb' bus='0' port='1'/&gt;</span><br><span class="line">    &lt;/input&gt;</span><br><span class="line">    &lt;input type='mouse' bus='ps2'/&gt;</span><br><span class="line">    &lt;input type='keyboard' bus='ps2'/&gt;</span><br><span class="line">    &lt;graphics type='spice' autoport='yes'&gt;</span><br><span class="line">      &lt;listen type='address'/&gt;</span><br><span class="line">      &lt;image compression='off'/&gt;</span><br><span class="line">    &lt;/graphics&gt;</span><br><span class="line">    &lt;sound model='ich6'&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;</span><br><span class="line">    &lt;/sound&gt;</span><br><span class="line">    &lt;video&gt;</span><br><span class="line">      &lt;model type='qxl' ram='65536' vram='65536' vgamem='16384' heads='1' primary='yes'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/&gt;</span><br><span class="line">    &lt;/video&gt;</span><br><span class="line">    &lt;redirdev bus='usb' type='spicevmc'&gt;</span><br><span class="line">      &lt;address type='usb' bus='0' port='2'/&gt;</span><br><span class="line">    &lt;/redirdev&gt;</span><br><span class="line">    &lt;redirdev bus='usb' type='spicevmc'&gt;</span><br><span class="line">      &lt;address type='usb' bus='0' port='3'/&gt;</span><br><span class="line">    &lt;/redirdev&gt;</span><br><span class="line">    &lt;memballoon model='virtio'&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/&gt;</span><br><span class="line">    &lt;/memballoon&gt;</span><br><span class="line">    &lt;rng model='virtio'&gt;</span><br><span class="line">      &lt;backend model='random'&gt;/dev/urandom&lt;/backend&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x09' function='0x0'/&gt;</span><br><span class="line">    &lt;/rng&gt;</span><br><span class="line">  &lt;/devices&gt;</span><br><span class="line">&lt;/domain&gt;</span><br><span class="line">必须修改name，uuid,mac地址，其余可选</span><br><span class="line"></span><br><span class="line">用vim修改完之后需要define一下配置文件</span><br><span class="line">[root@kvm-server ~]# virsh define /etc/libvirt/qemu/vm3.xml</span><br><span class="line">重启一下：</span><br><span class="line">[root@kvm-server ~]# systemctl restart libvirtd</span><br><span class="line">宿主机开启路由转发：</span><br><span class="line">[root@kvm-server ~]# vim /etc/sysctl.conf </span><br><span class="line">[root@kvm-server ~]# sysctl -p</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">=============</span><br><span class="line">查看虚拟机列表：</span><br><span class="line">[root@kvm-server ~]# virsh list --all</span><br><span class="line"> Id    名称                         状态</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> -     vm2                            关闭</span><br><span class="line"> -     vm3                            关闭</span><br><span class="line">或者如下：</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571906096410.png" alt="1571906096410"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571906906190.png" alt="1571906906190"></p>
<h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a><strong>备注</strong></h2><p>#####一、GuestOS安装问题解析</p>
<p><strong>问题1</strong>：用图形安装guest os的时候卡住不动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">解决：升级系统</span><br><span class="line">[root@qfedu.com ~]#  yum upgrade -y</span><br></pre></td></tr></table></figure>

<p><strong>问题2</strong>：升级系统后安装guest os的时候还是卡住不动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">解决：需要在安装宿主机的时候安装兼容性程序（有的同学就没有安装也可以使用，这可能是bug）</span><br></pre></td></tr></table></figure>

<p><strong>问题3</strong>：如果安装了各种兼容程序之后还是不行</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/wpsl5fXRB.jpg" alt="img"> </p>
<blockquote>
<p>如果所有问题都排查过后还是安装不上guestos，最后的原因就是在安装宿主机系统的时候各种兼容性软件没有安装而且Yum也没有自动处理导致的 </p>
</blockquote>
<h2 id="KVM虚拟机管理"><a href="#KVM虚拟机管理" class="headerlink" title="KVM虚拟机管理"></a><strong>KVM虚拟机管理</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">虚拟机的基本管理命令：</span><br><span class="line">查看</span><br><span class="line">启动</span><br><span class="line">关闭</span><br><span class="line">重启</span><br><span class="line">重置 </span><br><span class="line">===================</span><br><span class="line">[root@kvm-server ~]# virsh list  #列出在运行状态中的虚拟机</span><br><span class="line"> Id    名称                         状态</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 2     vm3                            running</span><br><span class="line">[root@kvm-server ~]# virsh list --all  #列出所有虚拟机</span><br><span class="line"> Id    名称                         状态</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 2     vm3                            running</span><br><span class="line"> -     vm2                            关闭</span><br><span class="line">查看kvm虚拟机配置文件：</span><br><span class="line">语法：virsh dumpxml name #虚拟机名字</span><br><span class="line">[root@kvm-server ~]# virsh dumpxml vm3</span><br><span class="line"></span><br><span class="line">将vm3虚拟机的配置文件保存至vm4.xml</span><br><span class="line">[root@kvm-server ~]# virsh dumpxml vm3 &gt; /etc/libvirt/qemu/vm4.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line">[root@kvm-server ~]# virsh start vm2</span><br><span class="line">域 vm2 已开始</span><br><span class="line"></span><br><span class="line">暂停虚拟机（挂起）：</span><br><span class="line">[root@kvm-server ~]# virsh suspend vm_name</span><br><span class="line">域 vm2 被挂起</span><br><span class="line"></span><br><span class="line">恢复虚拟机：</span><br><span class="line">[root@kvm-server ~]# virsh resume vm_name</span><br><span class="line">域 vm2 被重新恢复</span><br><span class="line"></span><br><span class="line">关闭：</span><br><span class="line">方法1：</span><br><span class="line">[root@kvm-server ~]# virsh shutdown vm3</span><br><span class="line">域 vm3 被关闭</span><br><span class="line">    </span><br><span class="line">方法2：</span><br><span class="line">[root@kvm-server ~]# virsh destroy vm3</span><br><span class="line"></span><br><span class="line">重启：</span><br><span class="line">[root@kvm-server ~]# virsh reboot vm3</span><br><span class="line">域 vm3 正在被重新启动</span><br><span class="line"></span><br><span class="line">重置:</span><br><span class="line">[root@kvm-server ~]# virsh reset vm3   #断电重启。速度快</span><br><span class="line">Domain vm3 was reset</span><br><span class="line"></span><br><span class="line">删除虚拟机:</span><br><span class="line">[root@kvm-server ~]# virsh undefine vm2</span><br><span class="line">Domain vm2 has been undefined</span><br><span class="line"></span><br><span class="line">注意:虚拟机在开启的情况下undefine是无法删除的只是删除定义将配置文件删除了，不能删除磁盘文件。需要手动rm</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">虚拟机开机自动启动:</span><br><span class="line"><span class="meta">#</span><span class="bash">如果虚拟机开机自启，里面的服务应该设置的有开机自启，不然没有意义</span></span><br><span class="line">[root@kvm-server ~]# virsh autostart vm3</span><br><span class="line">域 vm3标记为自动开始</span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# ls /etc/libvirt/qemu/autostart/     //此目录默认不存在，在有开机启动的虚拟机时自动创建</span><br><span class="line">vm3.xml</span><br><span class="line"></span><br><span class="line">关闭开机启动</span><br><span class="line">[root@kvm-server ~]# virsh autostart --disable vm3</span><br><span class="line">域 vm3取消标记为自动开始</span><br><span class="line">[root@kvm-server ~]# ls /etc/libvirt/qemu/autostart/</span><br><span class="line"></span><br><span class="line">如何查看已启动的虚拟机ip地址</span><br><span class="line">假如vm3虚拟机已启动</span><br><span class="line">[root@kvm-server ~]# virsh domifaddr vm3</span><br><span class="line"> 名称     MAC 地址           Protocol     Address</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"> vnet0      52:54:00:82:d6:3c    ipv4         192.168.122.85/24</span><br></pre></td></tr></table></figure>

<h2 id="虚拟机添加设备"><a href="#虚拟机添加设备" class="headerlink" title="虚拟机添加设备"></a><strong>虚拟机添加设备</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.图形方式:</span><br><span class="line">    首先，关闭要添加硬件的虚拟机</span><br><span class="line">    双击虚拟机，在打开的对话框点击上方的View，点击Details，点击Add Hardware可以选择要添加的虚拟硬件</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571910314774-1584350545507.png" alt="1571910314774"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571910431718-1584350545509.png" alt="1571910431718"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571910465326-1584350545509.png" alt="1571910465326"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571910479417-1584350545508.png" alt="1571910479417"></p>
<p>按需求点点就可以了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2.修改配置文件方式:</span><br><span class="line"></span><br><span class="line">我们给虚拟机vm3添加磁盘为例：</span><br><span class="line"></span><br><span class="line">首先需要创建出要添加的磁盘</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-server ~]# qemu-img create -f qcow2 /var/lib/libvirt/images/vm4-1.qcow2 5G</span><br><span class="line"></span><br><span class="line">注：创建空的磁盘文件：这里我们创建一个5G的磁盘，不过创建出来，通过ll -h查看大小，看不出它是5G，添加上之后才能看到</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-server ~]# cd /etc/libvirt/qemu/</span><br><span class="line">[root@kvm-server qemu]# vim vm3.xml</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571911539822-1584350545509.png" alt="1571911539822"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">加好之后，启动虚拟机</span><br><span class="line">[root@kvm-server qemu]# systemctl restart libvirtd</span><br><span class="line">[root@kvm-server qemu]# virsh list --all</span><br><span class="line"> Id    名称                         状态</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 6     centos7.0                      running</span><br><span class="line"> -     vm3                            关闭</span><br><span class="line">[root@kvm-server qemu]# virsh start vm3</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571911790388-1584350545509.png" alt="1571911790388"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">可以看到我们新添加的磁盘vdb</span><br><span class="line">然后可以正常分区，制作文件系统，进行挂载</span><br></pre></td></tr></table></figure>

<p><strong>虚拟机克隆</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.图形界面：Applications （左上角）-----&gt; System Tools ------&gt;Virtual Machine Manager</span><br><span class="line">   关闭要克隆的虚拟机，右键点击虚拟机选择Clone</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571970290792-1584350545509.png" alt="1571970290792"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">2.字符终端，命令克隆</span><br><span class="line">[root@kvm-server ~]# virt-clone -o vm2 --auto-clone</span><br><span class="line">正在分配 'vm2-clone.qcow2'                              | 5.0 GB  00:00     </span><br><span class="line">成功克隆 'vm2-clone'。</span><br><span class="line">-o       origin-原始</span><br><span class="line">    </span><br><span class="line">[root@kvm-server ~]# virt-clone -o vm2 -n vm5 --auto-clone</span><br><span class="line">正在分配 'vm5.qcow2'                                    | 5.0 GB  00:00     </span><br><span class="line">成功克隆 'vm5'。</span><br><span class="line">-n :指定新客户机的名字</span><br><span class="line">        </span><br><span class="line">[root@kvm-server ~]# virt-clone -o vm2 -n vm6 -f /var/lib/libvirt/images/vm6.img </span><br><span class="line">正在分配 'vm6.img'                                      | 5.0 GB  00:00     </span><br><span class="line">成功克隆 'vm6'。</span><br><span class="line">-f ，--file NEW_DISKFILE：为新客户机使用新的磁盘镜像文件</span><br><span class="line"></span><br><span class="line">这条命令在克隆的同时，可以指定镜像文件的位置和名称。</span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# virsh list --all</span><br><span class="line"> Id    名称                         状态</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> -     vm2                            关闭</span><br><span class="line"> -     vm2-clone                      关闭</span><br><span class="line"> -     vm3                            关闭</span><br><span class="line"> -     vm5                            关闭</span><br><span class="line"> -     vm6                            关闭</span><br></pre></td></tr></table></figure>

<p><strong>kvm高级命令</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">建立虚拟机磁盘镜像文件：</span><br><span class="line">磁盘镜像文件格式:</span><br><span class="line">qed  ----不用了</span><br><span class="line">    raw     原始格式，性能最好 直接占用你一开始给多少 系统就占多少 不支持快照</span><br><span class="line">    qcow  先去网上了解一下cow(写时拷贝copy on write) ，性能远不能和raw相比，所以很快夭折了，所以出现了qcow2（性能低下 早就被抛弃）</span><br><span class="line">    qcow2 性能上还是不如raw，但是raw不支持快照，qcow2支持快照。</span><br><span class="line"></span><br><span class="line">现在默认安装好的用的是raw格式，做快照要把他转换成qcow2格式</span><br><span class="line"></span><br><span class="line">什么叫写时拷贝？</span><br><span class="line">raw立刻分配空间，不管你有没有用到那么多空间</span><br><span class="line">qcow2只是承诺给你分配空间，但是只有当你需要用空间的时候，才会给你空间。最多只给你承诺空间的大小，避免空间浪费</span><br><span class="line"></span><br><span class="line">工作当中用哪个？看你用不用快照。本身做快照也是需要存储空间的。</span><br><span class="line">当然也不一定。数据绝对不会存储到本地。</span><br><span class="line"></span><br><span class="line">[root@kvm-server images]# pwd</span><br><span class="line">/var/lib/libvirt/images</span><br><span class="line"></span><br><span class="line">建立qcow2格式磁盘文件:</span><br><span class="line">[root@kvm-server images]# qemu-img create -f qcow2 test.img 5G</span><br><span class="line">Formatting 'test.img', fmt=qcow2 size=5368709120 encryption=off cluster_size=65536 lazy_refcounts=off </span><br><span class="line"></span><br><span class="line">qemu-kvm  qemu是早先的一个模拟器，kvm是基于qemu发展出来的。</span><br><span class="line"></span><br><span class="line">建立raw格式磁盘文件:</span><br><span class="line">[root@kvm-server images]# qemu-img create -f raw test.raw 5G</span><br><span class="line">Formatting 'test.raw', fmt=raw size=5368709120 </span><br><span class="line"></span><br><span class="line">查看已经创建的虚拟磁盘文件:</span><br><span class="line">[root@kvm-server images]# qemu-img info test.img </span><br><span class="line">[root@kvm-server images]# qemu-img info test.raw </span><br><span class="line"></span><br><span class="line">=============================================================================</span><br><span class="line">挂载磁盘</span><br><span class="line"></span><br><span class="line">将vm2虚拟机先关闭</span><br><span class="line">查看vm2的磁盘镜像分区信息:</span><br><span class="line">[root@kvm-server images]# virt-df -h -d vm2</span><br><span class="line">文件系统                                  大小      已用空间    可用空间     使用百分比%</span><br><span class="line">vm2:/dev/sda1                            1014M        92M       922M         10%</span><br><span class="line">vm2:/dev/centos/root                      3.5G       863M       2.6G         25%</span><br><span class="line"></span><br><span class="line">1.创建一个挂载目录</span><br><span class="line">[root@kvm-server images]# mkdir /test</span><br><span class="line">2.挂载虚拟机的跟分区到test目录</span><br><span class="line">[root@kvm-server images]# guestmount -d vm2 -m /dev/centos/root --rw /test/</span><br><span class="line">[root@kvm-server images]# cd /test/</span><br><span class="line">[root@kvm-server test]# ls</span><br><span class="line">bin   dev  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  etc  lib   media  opt  root  sbin  sys  usr</span><br><span class="line">[root@kvm-server test]# cat etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">games:x:12:100:games:/usr/games:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin</span><br><span class="line">dbus:x:81:81:System message bus:/:/sbin/nologin</span><br><span class="line">polkitd:x:999:997:User for polkitd:/:/sbin/nologin</span><br><span class="line">postfix:x:89:89::/var/spool/postfix:/sbin/nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line"></span><br><span class="line">取消挂载</span><br><span class="line">[root@kvm-server ~]# guestunmount /test</span><br></pre></td></tr></table></figure>

<h2 id="KVM网络配置"><a href="#KVM网络配置" class="headerlink" title="KVM网络配置"></a>KVM网络配置</h2><p><strong>两种网络</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nat与isolate（）</span><br><span class="line">NAT default方式：支持主机与虚拟机互访，虚拟机访问外界网络，但不支持外界访问虚拟机。</span><br><span class="line">isolate 隔离，host-host-only：仅主机模式。外网不能访问虚拟机，虚拟机也不能访问外网</span><br></pre></td></tr></table></figure>

<p>一种接口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bridge桥接</span><br></pre></td></tr></table></figure>

<p>nat网络</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571974868858-1584352936244.png" alt="1571974868858"></p>
<p>桥接网络</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571974792315-1584352936245.png" alt="1571974792315"></p>
<p>隔离网络</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191105224237889-1584352936245.png" alt="image-20191105224237889"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">可以通过查看mac地址是否一致来确定是不是一根线上的两个接口</span><br><span class="line">[root@kvm-server ~]# brctl show </span><br><span class="line">bridge name	bridge id		STP enabled	interfaces</span><br><span class="line">virbr0		8000.525400831963	yes		virbr0-nic</span><br><span class="line">							           vnet0</span><br><span class="line">							           vnet1</span><br><span class="line"></span><br><span class="line">注意：这里vnet网卡，是每台启动的虚拟机正在使用的网卡设备，每台虚拟机使用的不同						                             					                             </span><br><span class="line">从交换机上把vnet网卡删除：</span><br><span class="line">[root@kvm-server ~]# brctl delif virbr0 vnet0</span><br><span class="line"></span><br><span class="line">来到vm2的虚拟机，ping不通百度</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571975174322-1584352936245.png" alt="1571975174322"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">添加vnet网卡添加到交换机上：</span><br><span class="line">[root@kvm-server ~]# brctl addif virbr0 vnet0</span><br><span class="line">	</span><br><span class="line">来到vm2的虚拟机，恢复正常</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571975253586-1584352936245.png" alt="1571975253586"></p>
<p><strong>配置文件方式配置桥接：在宿主机上</strong></p>
<p>先将kvm虚拟机关闭</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">配置文件方式配置桥接：在宿主机上</span><br><span class="line">[root@kvm-server ~]# ip a   #先找出宿主机用的哪个网卡设备，我的是enp0s25</span><br><span class="line">[root@kvm-server ~]# cd /etc/sysconfig/network-scripts/</span><br><span class="line">1.定义网卡配置文件</span><br><span class="line">[root@kvm-server network-scripts]# vim ifcfg-br0    #没有此文件新建</span><br><span class="line">[root@kvm-server network-scripts]# cat ifcfg-br0</span><br><span class="line">TYPE=Bridge</span><br><span class="line">NAME=br0</span><br><span class="line">DEVICE=br0</span><br><span class="line">ONBOOT="yes"</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=10.0.111.182   #宿主的ip</span><br><span class="line">GATEWAY=10.0.111.1    #宿主的网关</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">DNS1=114.144.144.144</span><br><span class="line">DNS2=8.8.8.8</span><br><span class="line"></span><br><span class="line">然后看清楚宿主机正在使用的网卡，修改配置文件</span><br><span class="line">[root@kvm-server network-scripts]# cp ifcfg-enp0s25 ifcfg-enp0s25.back</span><br><span class="line">[root@kvm-server network-scripts]# vim ifcfg-enp0s25</span><br><span class="line">NAME=enp0s25   #定义网卡设备名称</span><br><span class="line">DEVICE=enp0s25   #宿主机正在使用的网卡设备</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BRIDGE=br0     #和ifcfg-br0文件里面的设备对应，新添加</span><br><span class="line">  </span><br><span class="line">2.重启libvirtd服务</span><br><span class="line">[root@kvm-server network-scripts]# systemctl restart libvirtd </span><br><span class="line">3.重启network服务 </span><br><span class="line">[root@kvm-server network-scripts]# systemctl restart network</span><br></pre></td></tr></table></figure>

<p>然后去查看有没有新设备生成</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976296620-1584352936245.png" alt="1571976296620"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976323666-1584352936245.png" alt="1571976323666"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976344474-1584352936245.png" alt="1571976344474"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976370886-1584352936245.png" alt="1571976370886"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976447246-1584352936246.png" alt="1571976447246"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976488946-1584352936245.png" alt="1571976488946"></p>
<p>可以看到，我们先添加的网卡设备</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976560155-1584352936245.png" alt="1571976560155"></p>
<p>移除操作</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976601202-1584352936246.png" alt="1571976601202"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976640707-1584352936246.png" alt="1571976640707"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976667604-1584352936246.png" alt="1571976667604"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571976709677-1584352936246.png" alt="1571976709677"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">删除桥接网卡步骤：</span><br><span class="line">1.删除br0的配置文件</span><br><span class="line">2.修改正常网卡的配置文件</span><br><span class="line">3.重启系统</span><br><span class="line"></span><br><span class="line">[root@kvm-server network-scripts]# mv ifcfg-br0 ifcfg-br0.bak</span><br><span class="line">[root@kvm-server network-scripts]# mv ifcfg-enp0s25 ifcfg-enp0s25.bak</span><br><span class="line">[root@kvm-server network-scripts]# mv ifcfg-enp0s25.back ifcfg-enp0s25</span><br><span class="line">[root@kvm-server network-scripts]# systemctl restart libvirtd</span><br><span class="line">[root@kvm-server network-scripts]# systemctl restart network</span><br><span class="line">[root@kvm-server network-scripts]# ping www.baidu.com</span><br><span class="line">PING www.a.shifen.com (39.156.66.14) 56(84) bytes of data.</span><br><span class="line">64 bytes from 39.156.66.14 (39.156.66.14): icmp_seq=1 ttl=52 time=13.3 ms</span><br></pre></td></tr></table></figure>

<p><strong>配置文件方式创建nat网络：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">配置文件方式创建nat网络：</span><br><span class="line">[root@kvm-server ~]# cd /etc/libvirt/qemu/networks</span><br><span class="line">[root@kvm-server networks]# ls</span><br><span class="line">autostar default.xml</span><br><span class="line">[root@kvm-server networks]# cp default.xml nat1.xml</span><br><span class="line">[root@kvm-server networks]# vim nat1.xml</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571986218420.png" alt="1571986218420"></p>
<p>重启服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-server netwoeks]# systemctl  restart libvirtd</span><br></pre></td></tr></table></figure>

<p>在某个（比如vm3）虚拟机去添加此设备测试</p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571985908262.png" alt="1571985908262"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571985936844.png" alt="1571985936844"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571985809125.png" alt="1571985809125"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571986318857.png" alt="1571986318857"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">配置文件方式创建isolated网络(host-only)：host-only模式我从来没用过，我们不再操作，有兴趣可以操作一下   </span><br><span class="line">[root@kvm-server networks]# cp default.xml isolated200.xml</span><br><span class="line">[root@kvm-server networks]# vim isolated200.xml</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571989161632.png" alt="1571989161632"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">启动：</span><br><span class="line">[root@kvm-server networks]# systemctl restart libvirtd</span><br><span class="line">开机自启动:</span><br><span class="line">[root@kvm-server networks]# virsh net-autostart  isolated200</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571990160154.png" alt="1571990160154"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看所有的网络：</span><br><span class="line">[root@kvm-server networks]# virsh net-list</span><br></pre></td></tr></table></figure>

<h2 id="KVM存储配置"><a href="#KVM存储配置" class="headerlink" title="KVM存储配置"></a><strong>KVM存储配置</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">存储池</span><br><span class="line">概念：</span><br><span class="line">    kvm必须要配置一个目录当作他存储磁盘镜像(存储卷)的目录，我们称这个目录为存储池</span><br><span class="line">    </span><br><span class="line">kvm默认存储池的位置：</span><br><span class="line">    /var/lib/libvirt/images/    </span><br><span class="line"></span><br><span class="line">1.创建基于文件夹的存储池（目录，可自定义）</span><br><span class="line">[root@kvm-server ~]# mkdir -p /data/vmfs</span><br><span class="line"></span><br><span class="line">2.定义存储池与其目录</span><br><span class="line">[root@kvm-server ~]# virsh pool-define-as vmdisk --type dir --target /data/vmfs</span><br><span class="line">Pool vmdisk defined</span><br><span class="line">解释：vmdisk是新建的存储池的名称。可自定义</span><br><span class="line"></span><br><span class="line">3.创建已定义的存储池</span><br><span class="line">(1)创建已定义的存储池</span><br><span class="line">[root@kvm-server ~]# virsh pool-build vmdisk</span><br><span class="line">Pool vmdisk built</span><br><span class="line"></span><br><span class="line">(2)查看已定义的存储池，存储池不激活无法使用。</span><br><span class="line">[root@kvm-server ~]# virsh pool-list --all</span><br><span class="line">Name                 State      Autostart </span><br><span class="line">-------------------------------------------</span><br><span class="line"> default              active     yes       </span><br><span class="line"> ISO                 active     yes       </span><br><span class="line"> vmdisk               inactive   no     </span><br><span class="line"></span><br><span class="line">4.激活并自动启动已定义的存储池</span><br><span class="line">[root@kvm-server ~]# virsh pool-start vmdisk</span><br><span class="line">Pool vmdisk started</span><br><span class="line">[root@kvm-server ~]# virsh pool-autostart vmdisk</span><br><span class="line">Pool vmdisk marked as autostarted</span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# virsh pool-list --all</span><br><span class="line"> Name                 State      Autostart </span><br><span class="line">-------------------------------------------</span><br><span class="line"> default              active     yes       </span><br><span class="line"> ISO                 active     yes       </span><br><span class="line"> vmdisk               active     yes   </span><br><span class="line">这里vmdisk存储池就已经创建好了，可以直接在这个存储池中创建虚拟磁盘文件了。</span><br><span class="line"></span><br><span class="line">5.在存储池中创建虚拟机存储卷</span><br><span class="line">[root@kvm-server ~]# virsh vol-create-as vmdisk vm99.qcow2 2G --format qcow2</span><br><span class="line">Vol vm99.qcow2 created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# ll /data/vmfs/ -h</span><br><span class="line">总用量 196K</span><br><span class="line">-rw------- 1 root root 193K 10月 25 16:04 vm99.qcow2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6.存储池相关管理命令</span><br><span class="line">(1)在存储池中删除虚拟机存储卷</span><br><span class="line">[root@kvm-server ~]# virsh vol-delete --pool vmdisk vm99.qcow2</span><br><span class="line">Vol vm99.qcow2 deleted</span><br><span class="line"></span><br><span class="line">(2)取消激活存储池</span><br><span class="line">[root@kvm-server ~]# virsh pool-destroy vmdisk</span><br><span class="line">Pool vmdisk destroyed</span><br><span class="line"></span><br><span class="line">(3)删除存储池定义的目录/data/vmfs</span><br><span class="line">[root@kvm-server ~]# virsh pool-delete vmdisk</span><br><span class="line">Pool vmdisk deleted</span><br><span class="line"></span><br><span class="line">(4)取消定义存储池</span><br><span class="line">[root@kvm-server ~]# virsh pool-undefine vmdisk</span><br><span class="line">Pool vmdisk has been undefined</span><br><span class="line"></span><br><span class="line">到此kvm存储池配置与管理操作完毕。</span><br></pre></td></tr></table></figure>

<h2 id="kvm快照"><a href="#kvm快照" class="headerlink" title="kvm快照"></a><strong>kvm快照</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">为虚拟机vm2创建一个快照（磁盘格式必须为qcow2）</span><br><span class="line">[root@kvm-server ~]# virsh snapshot-create-as vm2 vm2.snap1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：如果在创建快照的时候报错：</span><br><span class="line">error: unsupported configuration: internal snapshot for disk vda unsupported for storage type raw</span><br><span class="line"></span><br><span class="line">raw</span><br><span class="line">使用文件来模拟实际的硬盘(当然也可以使用一块真实的硬盘或一个分区)。由于原生的裸格式，不支持snapshot也是很正常的。</span><br><span class="line"></span><br><span class="line">qcow2</span><br><span class="line">现在比较主流的一种虚拟化镜像格式，经过一代的优化，目前qcow2的性能上接近raw裸格式的性能，这个也算是redhat的官方渠道了</span><br><span class="line">对于qcow2的格式，几点还是比较突出的：</span><br><span class="line">	•更小的存储空间</span><br><span class="line">	•支持多个snapshot，对历史snapshot进行管理</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">查看磁盘文件格式</span><br><span class="line">[root@kvm-server images]# qemu-img info /var/lib/libvirt/images/vm2.qcow2</span><br><span class="line">image: /var/lib/libvirt/images/vm2.qcow2</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 5.0G (5368709120 bytes)</span><br><span class="line">disk size: 5.0G</span><br><span class="line">cluster_size: 65536</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    lazy refcounts: true</span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# virsh snapshot-list  vm2   #查看某台虚拟机设备的快照</span><br><span class="line"> Name                 Creation Time             State</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">创建一块磁盘</span><br><span class="line">[root@kvm-server ~]# qemu-img create -f raw /var/lib/libvirt/images/vm2-1.raw 2G</span><br><span class="line">Formatting '/var/lib/libvirt/images/vm2-1.raw', fmt=raw size=2147483648 </span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# ll -h /var/lib/libvirt/images/vm2-1.raw</span><br><span class="line">-rw-r--r-- 1 root root 2.0G 10月 25 16:25 /var/lib/libvirt/images/vm2-1.raw</span><br><span class="line"></span><br><span class="line">将其添加到vm2虚拟机上面</span><br><span class="line">[root@kvm-server ~]# cd /etc/libvirt/qemu/</span><br><span class="line">[root@kvm-server qemu]# vim vm2.xml</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/1571997236706.png" alt="1571997236706"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-server images]# virsh define /etc/libvirt/qemu/vm2.xml</span><br><span class="line">[root@kvm-server images]# virsh start vm2</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-server qemu]# virsh snapshot-create-as vm2 vm2.snap1</span><br><span class="line">错误：不支持的配置：存储类型 vdb 不支持磁盘 raw 的内部快照</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">磁盘格式的转换</span><br><span class="line">由于raw的磁盘格式，不支持快照功能，我们需要将其转换为qcow2的格式</span><br><span class="line">[root@kvm-server qemu]# qemu-img convert -O qcow2 /var/lib/libvirt/images/vm2-1.raw  /var/lib/libvirt/images/vm2-1.qcow2</span><br><span class="line"></span><br><span class="line">[root@kvm-server qemu]# cd /var/lib/libvirt/images/</span><br><span class="line">[root@kvm-server images]# ll -h </span><br><span class="line">总用量 21G</span><br><span class="line">-rw------- 1 root root 5.1G 10月 24 18:59 centos7.0.qcow2</span><br><span class="line">-rw-r--r-- 1 root root 193K 10月 25 16:44 vm2-1.qcow2</span><br><span class="line">-rw-r--r-- 1 root root 2.0G 10月 25 16:25 vm2-1.raw</span><br><span class="line">-rw------- 1 root root 5.1G 10月 25 16:13 vm2.qcow2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@kvm-server images]# qemu-img info /var/lib/libvirt/images/vm2-1.qcow2</span><br><span class="line">image: /var/lib/libvirt/images/vm2-1.qcow2</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 2.0G (2147483648 bytes)</span><br><span class="line">disk size: 196K</span><br><span class="line">cluster_size: 65536</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    lazy refcounts: false</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">然后去修改vm2虚拟机的磁盘格式和名称</span><br><span class="line">[root@kvm-server images]# vim /etc/libvirt/qemu/vm2.xml</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191030151040012.png" alt="image-20191030151040012"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm-server images]# virsh define /etc/libvirt/qemu/vm2.xml</span><br><span class="line"></span><br><span class="line">创建快照</span><br><span class="line">[root@kvm-server qemu]# virsh snapshot-create-as vm2 vm2.snap2</span><br><span class="line">已生成域快照 vm2.snap2</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191030151139994.png" alt="image-20191030151139994"></p>
<p>然后我们开始做快照，图形化方式不再介绍</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">登录vm2的虚拟机：</span><br><span class="line">[root@vm2 ~]# mkdir /opt/test</span><br><span class="line">[root@kvm-server ~]# virsh snapshot-create-as vm2 vm2-snap3</span><br><span class="line">已生成域快照 vm2-snap3</span><br><span class="line"></span><br><span class="line">再次登录vm2的虚拟：</span><br><span class="line">[root@vm2 ~]# rm -rf /opt/test/</span><br><span class="line">[root@kvm-server ~]# virsh shutdown vm2</span><br><span class="line">[root@kvm-server ~]# virsh snapshot-create-as vm2 vm2-snap4</span><br><span class="line">已生成域快照 vm2-snap4</span><br><span class="line"></span><br><span class="line">查看快照</span><br><span class="line">[root@kvm-server ~]# virsh snapshot-list vm2 </span><br><span class="line"> 名称               生成时间              状态</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"> vm2-snap3            2019-10-30 15:27:15 +0800 running</span><br><span class="line"> vm2-snap4            2019-10-30 15:29:37 +0800 shutoff</span><br><span class="line"></span><br><span class="line">然后将vm2关闭，恢复到快照vm2.snap3</span><br><span class="line">[root@kvm-server ~]# virsh snapshot-revert vm2 vm2-snap3</span><br><span class="line">[root@kvm-server ~]# virsh start vm2</span><br><span class="line">Domain vm2 started</span><br><span class="line"></span><br><span class="line">在vm2虚拟机上查看</span><br><span class="line">[root@vm2 ~]# ls /opt/</span><br><span class="line">test</span><br><span class="line">可以再恢复到vm2.snap4测试一下</span><br><span class="line"></span><br><span class="line">删除虚拟机快照操作：</span><br><span class="line">[root@kvm-server ~]# virsh shutdown vm2</span><br><span class="line">[root@kvm-server ~]# virsh snapshot-list vm2</span><br><span class="line"> 名称               生成时间              状态</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"> vm2-snap3            2019-10-30 15:27:15 +0800 running</span><br><span class="line"> vm2-snap4            2019-10-30 15:29:37 +0800 shutoff</span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# virsh snapshot-delete --snapshotname vm2-snap3 vm2</span><br><span class="line">已删除域快照 vm2-snap3</span><br><span class="line"></span><br><span class="line">[root@kvm-server ~]# virsh snapshot-list vm2</span><br><span class="line"> 名称               生成时间              状态</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"> vm2-snap4            2019-10-30 15:27:15 +0800 running</span><br></pre></td></tr></table></figure>

<h2 id="kvm迁移（了解）"><a href="#kvm迁移（了解）" class="headerlink" title="kvm迁移（了解）"></a><strong>kvm迁移（了解）</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">最简单的方法：</span><br><span class="line">拷贝配置文件，磁盘</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">热迁移</span><br><span class="line"></span><br><span class="line">			  192.168.1.1/24	            192.168.1.2/24</span><br><span class="line">				++++++++++++            	++++++++++++</span><br><span class="line">				+			+			    +		    +		</span><br><span class="line">				+    KVM-A  +  =======&gt;     +	KVM-B 	+</span><br><span class="line">				+	    	+			    +	        +	</span><br><span class="line">				++++++++++++				++++++++++++</span><br><span class="line">			images                              images</span><br><span class="line">		/var/lib/libvirt/images	          /var/lib/libvirt/images</span><br></pre></td></tr></table></figure>

<h2 id="自动化脚本管理kvm（留时间给大家写）"><a href="#自动化脚本管理kvm（留时间给大家写）" class="headerlink" title="自动化脚本管理kvm（留时间给大家写）"></a>自动化脚本管理kvm（留时间给大家写）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">kvm batch create vm tool</span></span><br><span class="line"><span class="meta">#</span><span class="bash">version:0.1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">author:name</span></span><br><span class="line"><span class="meta">#</span><span class="bash">需要事先准备模板镜像和配置文件模板</span></span><br><span class="line">echo "1.创建自定义配置单个虚拟机</span><br><span class="line">2.批量创建自定义配置虚拟机</span><br><span class="line">3.批量创建默认配置虚拟机</span><br><span class="line">4.删除虚拟机"</span><br><span class="line"></span><br><span class="line">read -p "选取你的操作(1/2/3):" op</span><br><span class="line"></span><br><span class="line">batch_self_define() &#123;</span><br><span class="line"></span><br><span class="line">        kvmname=`openssl rand -hex 5`</span><br><span class="line"></span><br><span class="line">        sourceimage=/var/lib/libvirt/images/vmmodel.img</span><br><span class="line">        sourcexml=/etc/libvirt/qemu/vmmodel.xml</span><br><span class="line"></span><br><span class="line">        newimg=/var/lib/libvirt/images/$&#123;kvmname&#125;.img</span><br><span class="line">        newxml=/etc/libvirt/qemu/$&#123;kvmname&#125;.xml</span><br><span class="line"></span><br><span class="line">        cp $sourceimage  $newimg</span><br><span class="line">        cp $sourcexml $newxml</span><br><span class="line"></span><br><span class="line">        kvmuuid=`uuidgen`</span><br><span class="line">        kvmmem=$&#123;1&#125;000000</span><br><span class="line">        kvmcpu=$2</span><br><span class="line">        kvmimg=$newimg</span><br><span class="line">        kvmmac=`openssl rand -hex 3 | sed -r 's/..\B/&amp;:/g'`</span><br><span class="line"></span><br><span class="line">        sed -i "s@kvmname@$kvmname@;s@kvmuuid@$kvmuuid@;s@kvmmem@$kvmmem@;s@kvmcpu@$kvmcpu@;s@kvmimg@$kvmimg@;s@kvmmac@$kvmmac@" $newxml</span><br><span class="line">        virsh define $newxml</span><br><span class="line">        virsh list --all</span><br><span class="line">&#125;</span><br><span class="line">self_define() &#123;</span><br><span class="line">        read -p "请输入新虚机名称:" newname</span><br><span class="line">        read -p "请输入新虚机内存大小(G):" newmem</span><br><span class="line">        read -p "请输入新虚机cpu个数:" newcpu</span><br><span class="line"></span><br><span class="line">        sourceimage=/var/lib/libvirt/images/vmmodel.img</span><br><span class="line">        sourcexml=/etc/libvirt/qemu/vmmodel.xml</span><br><span class="line"></span><br><span class="line">        newimg=/var/lib/libvirt/images/$&#123;newname&#125;.img</span><br><span class="line">        newxml=/etc/libvirt/qemu/$&#123;newname&#125;.xml</span><br><span class="line"></span><br><span class="line">        cp $sourceimage  $newimg</span><br><span class="line">        cp $sourcexml $newxml</span><br><span class="line"></span><br><span class="line">        kvmname=$newname</span><br><span class="line">        kvmuuid=`uuidgen`</span><br><span class="line">        kvmmem=$&#123;newmem&#125;000000</span><br><span class="line">        kvmcpu=$newcpu</span><br><span class="line">        kvmimg=$newimg</span><br><span class="line">        kvmmac=`openssl rand -hex 3 | sed -r 's/..\B/&amp;:/g'`</span><br><span class="line"></span><br><span class="line">        sed -i "s@kvmname@$kvmname@;s@kvmuuid@$kvmuuid@;s@kvmmem@$kvmmem@;s@kvmcpu@$kvmcpu@;s@kvmimg@$kvmimg@;s@kvmmac@$kvmmac@" $newxml</span><br><span class="line">        virsh define $newxml</span><br><span class="line">        virsh list --all</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $op in</span><br><span class="line">1)self_define;;</span><br><span class="line">2)</span><br><span class="line">        read -p "请输入要创建的虚拟机的个数:" num</span><br><span class="line">        read -p "请输入新虚机内存大小(G):" newmem</span><br><span class="line">        read -p "请输入新虚机cpu个数:" newcpu</span><br><span class="line"></span><br><span class="line">        for((i=1;i&lt;=$num;i++))</span><br><span class="line">        do</span><br><span class="line">                batch_self_define $newmem $newcpu</span><br><span class="line">        done;;</span><br><span class="line"></span><br><span class="line">3)</span><br><span class="line">        read -p "请输入要创建的虚拟机的个数:" num</span><br><span class="line"></span><br><span class="line">        for((i=1;i&lt;=$num;i++))</span><br><span class="line">        do</span><br><span class="line">                batch_self_define 1 1</span><br><span class="line">        done;;</span><br><span class="line"></span><br><span class="line">*)echo "输入错误，请重新执行脚本"</span><br><span class="line">  exit;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p><strong>配置文件模板</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vim /etc/libvirt/qemu/vmmodel.xml</span></span><br><span class="line">&lt;domain type='kvm'&gt;</span><br><span class="line">  &lt;name&gt;kvmname&lt;/name&gt;</span><br><span class="line">  &lt;uuid&gt;kvmuuid&lt;/uuid&gt;</span><br><span class="line">  &lt;memory unit='KiB'&gt;kvmmem&lt;/memory&gt;</span><br><span class="line">  &lt;currentMemory unit='KiB'&gt;kvmmem&lt;/currentMemory&gt;</span><br><span class="line">  &lt;vcpu placement='static'&gt;kvmcpu&lt;/vcpu&gt;</span><br><span class="line">  &lt;os&gt;</span><br><span class="line">    &lt;type arch='x86_64' machine='pc-i440fx-rhel7.0.0'&gt;hvm&lt;/type&gt;</span><br><span class="line">    &lt;boot dev='hd'/&gt;</span><br><span class="line">  &lt;/os&gt;</span><br><span class="line">  &lt;features&gt;</span><br><span class="line">    &lt;acpi/&gt;</span><br><span class="line">    &lt;apic/&gt;</span><br><span class="line">  &lt;/features&gt;</span><br><span class="line">  &lt;cpu mode='custom' match='exact' check='partial'&gt;</span><br><span class="line">    &lt;model fallback='allow'&gt;Haswell-noTSX&lt;/model&gt;</span><br><span class="line">  &lt;/cpu&gt;</span><br><span class="line">  &lt;clock offset='utc'&gt;</span><br><span class="line">    &lt;timer name='rtc' tickpolicy='catchup'/&gt;</span><br><span class="line">    &lt;timer name='pit' tickpolicy='delay'/&gt;</span><br><span class="line">    &lt;timer name='hpet' present='no'/&gt;</span><br><span class="line">  &lt;/clock&gt;</span><br><span class="line">  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;</span><br><span class="line">  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;</span><br><span class="line">  &lt;on_crash&gt;destroy&lt;/on_crash&gt;</span><br><span class="line">  &lt;pm&gt;</span><br><span class="line">    &lt;suspend-to-mem enabled='no'/&gt;</span><br><span class="line">    &lt;suspend-to-disk enabled='no'/&gt;</span><br><span class="line">  &lt;/pm&gt;</span><br><span class="line">  &lt;devices&gt;</span><br><span class="line">    &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;</span><br><span class="line">    &lt;disk type='file' device='disk'&gt;</span><br><span class="line">      &lt;driver name='qemu' type='qcow2'/&gt;</span><br><span class="line">      &lt;source file='kvmimg'/&gt;</span><br><span class="line">      &lt;target dev='vda' bus='virtio'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x0'/&gt;</span><br><span class="line">    &lt;/disk&gt;</span><br><span class="line">    &lt;controller type='usb' index='0' model='ich9-ehci1'&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x7'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type='usb' index='0' model='ich9-uhci1'&gt;</span><br><span class="line">      &lt;master startport='0'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0' multifunction='on'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type='usb' index='0' model='ich9-uhci2'&gt;</span><br><span class="line">      &lt;master startport='2'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x1'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type='usb' index='0' model='ich9-uhci3'&gt;</span><br><span class="line">      &lt;master startport='4'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x2'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type='pci' index='0' model='pci-root'/&gt;</span><br><span class="line">    &lt;controller type='virtio-serial' index='0'&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;interface type='network'&gt;</span><br><span class="line">      &lt;mac address='52:54:00:kvmmac'/&gt;</span><br><span class="line">      &lt;source network='default'/&gt;</span><br><span class="line">      &lt;model type='virtio'/&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;</span><br><span class="line">    &lt;/interface&gt;</span><br><span class="line">    &lt;serial type='pty'&gt;</span><br><span class="line">      &lt;target type='isa-serial' port='0'&gt;</span><br><span class="line">        &lt;model name='isa-serial'/&gt;</span><br><span class="line">      &lt;/target&gt;</span><br><span class="line">    &lt;/serial&gt;</span><br><span class="line">    &lt;console type='pty'&gt;</span><br><span class="line">      &lt;target type='serial' port='0'/&gt;</span><br><span class="line">    &lt;/console&gt;</span><br><span class="line">    &lt;channel type='unix'&gt;</span><br><span class="line">      &lt;target type='virtio' name='org.qemu.guest_agent.0'/&gt;</span><br><span class="line">      &lt;address type='virtio-serial' controller='0' bus='0' port='1'/&gt;</span><br><span class="line">    &lt;/channel&gt;</span><br><span class="line">    &lt;input type='mouse' bus='ps2'/&gt;</span><br><span class="line">    &lt;input type='keyboard' bus='ps2'/&gt;</span><br><span class="line">    &lt;memballoon model='virtio'&gt;</span><br><span class="line">      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;</span><br><span class="line">    &lt;/memballoon&gt;</span><br><span class="line">  &lt;/devices&gt;</span><br><span class="line">&lt;/domain&gt;</span><br></pre></td></tr></table></figure>

<p><strong>随机生成mac地址</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">其中方式如下：</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> `openssl rand -hex 1`:`openssl rand -hex 1`:`openssl rand -hex 1`</span></span><br><span class="line">99:6e:67</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> openssl rand -hex 3 | sed -r <span class="string">'s/(..)(..)(..)/\1:\2:\3/g'</span></span></span><br><span class="line">94:89:e3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> openssl rand -hex 3 | sed -r <span class="string">'s/..\B/&amp;:/g'</span></span></span><br><span class="line">c5:66:90</span><br></pre></td></tr></table></figure>

<p><strong>Centos设置输入法</strong></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191030165857060.png" alt="image-20191030165857060"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191030165907559.png" alt="image-20191030165907559"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191030165917440.png" alt="image-20191030165917440"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191030165929234.png" alt="image-20191030165929234"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191030165940597.png" alt="image-20191030165940597"></p>
<p><img src= "/img/loading.gif" data-src="/2020/07/27/kvm/image-20191030165949687.png" alt="image-20191030165949687"></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">CG</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/07/27/kvm/">http://yoursite.com/2020/07/27/kvm/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Morning</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Morning</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2020/07/27/docker/"><img class="prev-cover" data-src="https://cdn.shawnlin.cn/blog/images/main.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">docker</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By CG</div><div class="footer_custom_text">welcome to my blog</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/third-party/click_heart.js"></script><script src="/js/search/local-search.js"></script><script src="/js/bot.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>